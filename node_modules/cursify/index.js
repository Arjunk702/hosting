module.exports = function cursify(img) {
	const { distort, invert } = require("./canvas.js")
	const Canvas = require("canvas")
	const fs = require("fs")
	Canvas.loadImage(img).then( image => {
		let canvas = Canvas.createCanvas(image.width, image.height)
		let ctx = canvas.getContext('2d')
		ctx.drawImage(image, 0, 0, image.width, image.height)
		distort(ctx, 10, 0, 0, image.width, image.height)
		let buffer = canvas.toBuffer('image/jpeg')
		fs.writeFileSync('./output.jpeg', buffer)
		console.log("image1 wrote")
	})

	function step2() {Canvas.loadImage('./output.jpeg').then( image => {
        	let canvas = Canvas.createCanvas(image.width, image.height)
        	let ctx = canvas.getContext('2d')
        	ctx.drawImage(image, 0, 0, image.width, image.height)
        	invert(ctx, 0, 0, image.width, image.height)
        	let buffer = canvas.toBuffer('image/jpeg')
        	fs.writeFileSync('./output.jpeg', buffer)
        	console.log("image2 wrote")
	})}
	setTimeout(step2, 100)
}
